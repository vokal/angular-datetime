/*! angular-datetime Copyright Vokal 2015 */
angular.module("vokal.datePicker",[]).directive("datePicker",["$compile","$filter",function(a,b){"use strict";return{restrict:"A",scope:{},require:"ngModel",link:function(c,d,e,f){f.$parsers.unshift(function(a){var c=new Date(a);return f.$setValidity("date",!isNaN(c.getTime())),"string"===e.pickerType?b("date")(c,e.datePicker||"M/d/yyyy"):c}),f.$formatters.push(function(a){var c,d=a;return d&&("function"!=typeof d.getTime&&(d=new Date(d)),c=!isNaN(d.getTime()),f.$setValidity("date",c)),c?b("date")(d,e.datePicker||"M/d/yyyy"):a}),c.showDatepicker=!1;var g=new Date;c.dayNow=g.getDate(),c.monthNow=g.getMonth()+1,c.yearNow=g.getFullYear(),c.dayNames=["Su","Mo","Tu","We","Th","Fr","Sa"],c.buildMonth=function(a,d){c.days=[],c.filler=[],c.year=a,c.month=d,c.monthName=b("date")(a+"-"+(10>d?"0":"")+d+"-01","MMMM"),c.prevYear=1>d-1?a-1:a,c.nextYear=d+1>12?a+1:a,c.prevMonth=1>d-1?12:d-1,c.nextMonth=d+1>12?1:d+1;for(var e=32-new Date(a,d-1,32).getDate(),f=new Date(a,d-1,1).getDay(),g=1;e>=g;g++)c.days.push(g);for(var h=0;f>h;h++)c.filler.push(h)},c.applyDate=function(a){var d=new Date(a),g=b("date")(d,e.datePicker||"M/d/yyyy");f.$setViewValue(g),f.$render(),c.showDatepicker=!1};var h=angular.element('<div class="date-picker" data-ng-show="showDatepicker"><div class="month-name">{{ monthName }} {{ year }}</div><div class="month-prev" data-ng-click="buildMonth( prevYear, prevMonth )">&lt;</div><div class="month-next" data-ng-click="buildMonth( nextYear, nextMonth )">&gt;</div><div class="day-name-cell" data-ng-repeat="dayName in dayNames">{{ dayName }}</div><div class="filler-space" data-ng-repeat="space in filler"></div><div class="date-cell" data-ng-class="{ today: dayNow == day && monthNow == month && yearNow == year }" data-ng-repeat="day in days" data-ng-click="applyDate( month + \'/\' + day + \'/\' + year )">{{ day }}</div></div>');a(h)(c),d.after(h),d.on("click",function(){c.$apply(function(){var a,b;if(Date.parse(f.$modelValue)){var d=new Date(f.$modelValue);a=d.getFullYear(),b=d.getMonth()+1}else a=c.yearNow,b=c.monthNow;c.buildMonth(a,b),c.showDatepicker=!0})}),d.on("keydown paste",function(){c.$apply(function(){c.showDatepicker=!1})}),angular.element(document.getElementsByTagName("html")[0]).on("mousedown touchstart",function(a){if(c.showDatepicker){for(var b=angular.element(a.target).scope();b;b=b.$parent)if(c.$id===b.$id)return;c.$apply(function(){c.showDatepicker=!1})}})}}}]);