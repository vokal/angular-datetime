/*! angular-datetime Copyright Vokal 2015 */
angular.module("vokal.datePicker",[]).directive("datePicker",["$compile","$filter",function(a,b){"use strict";function c(a){return!!a&&angular.isFunction(a.getTime)&&!isNaN(a.getTime())}function d(a){return c(a)?a:new Date(a)}var e="M/d/yyyy";return{restrict:"A",scope:{date:"=ngModel"},require:"ngModel",link:function(f,g,h,i){function j(a){return"string"===h.pickerType?b("date")(a,h.datePicker||e):a}function k(a){return j(f.date?new Date(a.toDateString()+" "+d(f.date).toTimeString()):a)}i.$parsers.unshift(function(a){a=new Date(a);var b=c(a);return i.$setValidity("date",b),b?k(a):f.date}),i.$formatters.push(function(a){var f=d(a),g=c(f);return i.$setValidity("date",g),g?b("date")(f,h.datePicker||e):a}),f.showDatepicker=!1;var l=new Date;f.dayNow=l.getDate(),f.monthNow=l.getMonth()+1,f.yearNow=l.getFullYear(),f.dayNames=["Su","Mo","Tu","We","Th","Fr","Sa"],f.buildMonth=function(a,c){f.days=[],f.filler=[],f.year=a,f.month=c,f.monthName=b("date")(a+"-"+(10>c?"0":"")+c+"-01","MMMM"),f.prevYear=1>c-1?a-1:a,f.nextYear=c+1>12?a+1:a,f.prevMonth=1>c-1?12:c-1,f.nextMonth=c+1>12?1:c+1;for(var d=32-new Date(a,c-1,32).getDate(),e=new Date(a,c-1,1).getDay(),g=1;d>=g;g++)f.days.push(g);for(var h=0;e>h;h++)f.filler.push(h)},f.applyDate=function(a){var c=new Date(a),d=b("date")(c,h.datePicker||e);i.$setViewValue(d),i.$render(),f.showDatepicker=!1};var m=angular.element('<div class="date-picker" data-ng-show="showDatepicker"><div class="month-name">{{ monthName }} {{ year }}</div><div class="month-prev" data-ng-click="buildMonth( prevYear, prevMonth )">&lt;</div><div class="month-next" data-ng-click="buildMonth( nextYear, nextMonth )">&gt;</div><div class="day-name-cell" data-ng-repeat="dayName in dayNames">{{ dayName }}</div><div class="filler-space" data-ng-repeat="space in filler"></div><div class="date-cell" data-ng-class="{ today: dayNow == day && monthNow == month && yearNow == year }" data-ng-repeat="day in days" data-ng-click="applyDate( month + \'/\' + day + \'/\' + year )">{{ day }}</div></div>');a(m)(f),g.after(m),g.on("click",function(){f.$apply(function(){var a,b;if(Date.parse(i.$modelValue)){var c=new Date(i.$modelValue);a=c.getFullYear(),b=c.getMonth()+1}else a=f.yearNow,b=f.monthNow;f.buildMonth(a,b),f.showDatepicker=!0})}),g.on("keydown paste",function(){f.$apply(function(){f.showDatepicker=!1})});var n=function(a){g[0].contains(a.target)||f.$apply(function(){f.showDatepicker=!1})};$document.on("mousedown touchstart",n),f.$on("$destroy",function(){$document.off("mousedown touchstart",n)})}}}]);